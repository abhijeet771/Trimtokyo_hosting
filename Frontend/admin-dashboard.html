<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TrimTokyo | Admin Dashboard</title>
  <style>
    body {
      margin:0; padding:0;
      font-family:'Roboto Slab',Arial,sans-serif;
      background: linear-gradient(to bottom,#fefefe 0%,#d7fbe8 50%,#fddde6 100%);
    }
    header {
      display:flex; justify-content:space-between; align-items:center;
      background:#28a99e; color:white;
      padding:15px 40px; box-shadow:0 2px 5px rgba(0,0,0,0.1);
      position:sticky; top:0; z-index:10;
    }
    header h1 { margin:0; font-size:1.5em; }
    .actions button {
      padding:8px 16px; border:none; border-radius:20px;
      background:white; color:#28a99e; cursor:pointer; font-weight:bold;
      transition:0.3s;
    }
    .actions button:hover { background:#f0f0f0; }
    .section-box {
      background: rgba(255,255,255,0.9); margin:30px auto;
      padding:20px; width:90%; max-width:1000px;
      border-radius:15px; box-shadow:0 3px 8px rgba(0,0,0,.15);
    }
    h2 { margin-bottom:15px; font-size:1.6em; text-align:center; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:10px; text-align:left; border-bottom:1px solid #ccc; }
    th { background:#28a99e; color:white; }
    .status-pending { color: orange; font-weight:bold; }
    .status-completed { color: green; font-weight:bold; }
    footer { text-align:center; padding:10px; background:#28a99e; color:white; font-size:.9em; margin-top:40px; }
  </style>
</head>
<body>

<header>
  <h1>Admin Dashboard</h1>
  <div class="actions">
    <button onclick="logout()">Logout</button>
  </div>
</header>

<div class="section-box">
  <h2>All Orders</h2>
  <div id="orders-container">
    <p>Loading orders...</p>
  </div>
</div>

<footer>© TrimTokyo Admin Panel</footer>

<script>
const token = localStorage.getItem("token");

// Check login
if(!token) {
  alert("Please login first!");
  window.location.href = "login.html";
}

function logout() {
  localStorage.removeItem("token");
  window.location.href = "login.html";
}

// Load all orders
async function loadOrders() {
  try {
    const res = await fetch("http://localhost:5000/api/admin/order/all", {
      headers: { Authorization: `Bearer ${token}` }
    });
    const data = await res.json();

    const container = document.getElementById("orders-container");

    if(!res.ok) {
      container.innerHTML = `<p style="color:red;">${data.message || 'Failed to load orders.'}</p>`;
      return;
    }

    if(data.orders.length === 0) {
      container.innerHTML = `<p>No orders yet.</p>`;
      return;
    }

    // Build table
    const table = document.createElement("table");
    table.innerHTML = `
      <thead>
        <tr>
          <th>#</th>
          <th>User ID</th>
          <th>Items</th>
          <th>Total Amount</th>
          <th>Payment</th>
          <th>Status</th>
          <th>Ordered At</th>
        </tr>
      </thead>
      <tbody>
        ${data.orders.map((order, index) => `
          <tr>
            <td>${index+1}</td>
            <td>${order.userId}</td>
            <td>
              ${order.items.map(i => `${i.serviceName} - ₹${i.price}`).join("<br>")}
            </td>
            <td>₹${order.totalAmount}</td>
            <td>${order.paymentMethod}</td>
            <td class="status-${order.status.toLowerCase()}">${order.status}</td>
            <td>${new Date(order.createdAt).toLocaleString()}</td>
          </tr>
        `).join("")}
      </tbody>
    `;
    container.innerHTML = "";
    container.appendChild(table);

  } catch(err) {
    console.error(err);
    document.getElementById("orders-container").innerHTML = `<p style="color:red;">Error fetching orders.</p>`;
  }
}

loadOrders();
</script>
</body>
</html>
